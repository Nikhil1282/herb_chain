<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>ЁЯОд Voice Registration | Farmer</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f9f9f9;
      text-align: center;
      padding: 50px;
    }
    h2 {
      color: #2c3e50;
    }
    button {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 6px;
      background-color: #27ae60;
      color: white;
      cursor: pointer;
    }
    button:hover {
      background-color: #2ecc71;
    }
    #status {
      margin-top: 20px;
      font-size: 18px;
      color: #555;
    }
  </style>
</head>
<body>
  <h2>ЁЯОд рдХрд┐рд╕рд╛рди рдкрдВрдЬреАрдХрд░рдг (Voice Registration)</h2>
  <button onclick="startVoiceRegister()">рдЖрд╡рд╛рдЬрд╝ рд╕реЗ рдкрдВрдЬреАрдХрд░рдг рд╢реБрд░реВ рдХрд░реЗрдВ</button>
  <p id="status"></p>

  <script>
    const synth = window.speechSynthesis;
    const recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
    recognition.lang = 'hi-IN';
    recognition.continuous = false;
    recognition.interimResults = false;

    let farmerData = { name: '', phone: '', password: '' };
    let step = 0;

    function speak(text, callback = null) {
      const utter = new SpeechSynthesisUtterance(text);
      utter.lang = 'hi-IN';
      synth.speak(utter);
      utter.onend = () => {
        if (callback) callback();
      };
    }

    function listen() {
      recognition.start();
      document.getElementById('status').innerText = "ЁЯОЩя╕П рд╕реБрди рд░рд╣реЗ рд╣реИрдВ...";
    }

    recognition.onresult = (event) => {
      const result = event.results[0][0].transcript.trim();
      document.getElementById('status').innerText = "тЬЕ рдЖрдкрдиреЗ рдХрд╣рд╛: " + result;

      if (step === 0) {
        farmerData.name = result;
        step++;
        speak("рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдореЛрдмрд╛рдЗрд▓ рдирдВрдмрд░ рдмрддрд╛рдЗрдПред", listen);
      } 
      else if (step === 1) {
        // remove non-digits
        farmerData.phone = result.replace(/\D/g, '');
        step++;
        speak("рдЕрдм рдЕрдкрдирд╛ рдкрд╛рд╕рд╡рд░реНрдб рдмреЛрд▓рд┐рдПред", listen);
      } 
      else if (step === 2) {
        farmerData.password = result;
        step++;
        speak("рдзрдиреНрдпрд╡рд╛рдж, рдЖрдкрдХрд╛ рдкрдВрдЬреАрдХрд░рдг рдХрд┐рдпрд╛ рдЬрд╛ рд░рд╣рд╛ рд╣реИ...");

        fetch('/register_farmer', {
          method: 'POST',
          headers: {'Content-Type': 'application/x-www-form-urlencoded'},
          body: `name=${encodeURIComponent(farmerData.name)}&phone=${encodeURIComponent(farmerData.phone)}&password=${encodeURIComponent(farmerData.password)}`
        })
        .then(response => {
          if (response.redirected) {
            window.location.href = response.url;
          } else {
            document.getElementById('status').innerText = "тЬЕ Registration complete!";
          }
        })
        .catch(err => {
          document.getElementById('status').innerText = "тЭМ Error: " + err.message;
        });
      }
    };

    recognition.onerror = (event) => {
      document.getElementById('status').innerText = "тЪая╕П Error: " + event.error;
    };

    function startVoiceRegister() {
      step = 0;
      farmerData = { name: '', phone: '', password: '' };
      speak("рдЕрдкрдирд╛ рдирд╛рдо рдмрддрд╛рдЗрдПред", listen);
    }
  </script>
</body>
</html>
